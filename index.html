<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Israel Winlade — Living Manuscript</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Spectral:ital,wght@0,200..800;1,200..800&family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
<meta name="color-scheme" content="dark light">
<style>
:root{
  --ink:#e8ecf5; --paper:#0c1019; --bone:#f3f2ee; --cyan:#7cf0ff; --accent:#bda27a; --muted:#a7b0c3;
  --glass:rgba(255,255,255,.06); --edge:rgba(255,255,255,.12); --shadow:0 30px 90px rgba(0,0,0,.55);
  --spot:260px; --r:16px; --max:1200px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 600px at 10% -10%, rgba(124,240,255,.12) 0%, transparent 60%), #0b1020;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;overflow-x:hidden}
img{max-width:100%;display:block}
.container{width:min(var(--max),92vw);margin:0 auto}

/* Paper texture (subtle) */
.paper{position:fixed;inset:-15%;z-index:-3;pointer-events:none;filter:contrast(105%) saturate(110%);opacity:.6;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 200 200"><filter id="f"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2"/><feColorMatrix values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 .06 0"/></filter><rect width="100%" height="100%" filter="url(%23f)"/></svg>')}
.grid{position:fixed;inset:-10%;z-index:-4;pointer-events:none;opacity:.5;background-image:linear-gradient(transparent 95%, rgba(255,255,255,.05) 100%),linear-gradient(90deg, transparent 95%, rgba(255,255,255,.05) 100%);background-size:26px 26px;mix-blend-mode:overlay}
.spot{position:fixed;inset:0;pointer-events:none;mix-blend-mode:screen;background:radial-gradient(var(--spot) var(--spot) at var(--sx,50%) var(--sy,50%), rgba(124,240,255,.14), transparent 60%);z-index:1}

/* Nav */
nav[aria-label="Primary"]{position:fixed;left:50%;top:14px;transform:translateX(-50%);z-index:60;display:flex;gap:8px;align-items:center;padding:8px;border-radius:999px;background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--edge);box-shadow:var(--shadow)}
nav a,nav button{color:inherit;background:transparent;border:0;border-radius:999px;padding:8px 12px;cursor:pointer}
nav a:hover,nav button:hover{background:rgba(255,255,255,.06)}

/* Hero */
.hero{min-height:96svh;display:grid;place-items:center;padding-top:96px;position:relative}
.hero .wrap{display:grid;gap:28px;align-items:center}
@media(min-width:980px){.hero .wrap{grid-template-columns:1.1fr .9fr}}
.hero h1{font-family:Spectral,ui-serif,Georgia;font-weight:700;font-size:clamp(34px,6vw,62px);line-height:1.05;margin:0 0 10px;letter-spacing:.2px}
.hero p{color:var(--muted);max-width:60ch;margin:0}
.badge{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--edge);background:rgba(255,255,255,.06);padding:6px 12px;border-radius:999px;font-size:12px}
.badge i{width:6px;height:6px;border-radius:999px;background:linear-gradient(145deg,var(--cyan),#358b9c)}
.hero .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
.btn{position:relative;display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border:1px solid var(--edge);border-radius:14px;background:rgba(255,255,255,.06);backdrop-filter:blur(8px);cursor:pointer;transition:transform .2s}
.btn::after{content:"";position:absolute;inset:-10px;border-radius:22px;box-shadow:0 0 40px rgba(124,240,255,.2);opacity:0;transition:.25s}
.btn:hover{transform:translateY(-1px)}
.btn:hover::after{opacity:1}

/* Sections */
main section{padding:110px 0}
h2{font-family:Spectral,ui-serif,Georgia;font-size:28px;margin:0 0 14px}
.muted{color:var(--muted)}

/* Living Manuscript (palimpsest scroll) */
.folio{position:sticky;top:0;min-height:100svh;display:grid;place-items:center}
.folio .page{width:min(860px,86vw);border-radius:18px;padding:28px;border:1px solid var(--edge);background:rgba(255,255,255,.03);backdrop-filter:blur(8px);box-shadow:var(--shadow);position:relative}
.folio .page::before{content:attr(data-watermark);position:absolute;right:14px;top:10px;font-family:IBM Plex Mono,ui-monospace,monospace;font-size:12px;color:#ffffff3a}
.folio[data-active="0"]{filter:saturate(.6) blur(.3px) brightness(.9)}

.var{font-variation-settings:"wght" 420,"wdth" 100;transition:font-variation-settings .4s ease}
.var:hover{font-variation-settings:"wght" 760,"wdth" 95}
.edit{position:relative}
.edit del{opacity:.65}
.edit ins{color:var(--cyan);text-decoration:none}
.edit .caret{position:relative}
.edit .caret::after{content:"^";position:absolute;left:.1em;bottom:-.4em;color:var(--accent)}
.marg{color:#c7d2e8;font-family:IBM Plex Mono,ui-monospace,monospace;font-size:12px;opacity:.9}

/* Timeline (Scroll As Time) */
.timeline{position:relative}
.timeline .scribe{position:fixed;left:calc(50% - 620px);top:0;bottom:0;width:2px;background:linear-gradient(var(--cyan),transparent);opacity:.35;pointer-events:none}
.timeline .items{display:grid;gap:18px}
.artifact{border:1px solid var(--edge);background:rgba(255,255,255,.04);border-radius:14px;padding:14px;transition:opacity .3s,transform .3s}
.artifact[data-revealed="0"]{opacity:.0;transform:translateY(10px)}

/* Dossier + Projects */
.grid2{display:grid;gap:16px}
@media(min-width:900px){.grid2{grid-template-columns:repeat(2,1fr)}}
.card{border:1px solid var(--edge);background:rgba(255,255,255,.05);border-radius:18px;padding:18px;box-shadow:var(--shadow)}
.tilt{transform-style:preserve-3d;perspective:1000px}
.tilt .inner{transform:translateZ(0);transition:transform .22s ease,filter .22s}
.reveal{transform:translateY(12px) scale(.985);opacity:0}
.reveal.in{transform:none;opacity:1;transition:.6s cubic-bezier(.17,.84,.44,1)}

/* Citation Constellation */
.constellationWrap{position:relative;border:1px solid var(--edge);border-radius:18px;overflow:hidden}
#constellation{display:block;width:100%;height:min(520px,72svh);background:radial-gradient(900px 600px at 10% 0%,rgba(124,240,255,.06),transparent 60%), rgba(0,0,0,.25)}
#abstract{position:absolute;left:16px;bottom:16px;max-width:min(520px,80%);padding:12px 14px;border-radius:12px;background:rgba(10,14,24,.8);border:1px solid var(--edge);display:none}

/* Marginalia OS (panes) */
.pane{position:fixed;right:16px;top:110px;min-width:min(420px,92vw);max-width:520px;border:1px solid var(--edge);border-radius:16px;background:rgba(10,14,24,.9);color:var(--ink);box-shadow:var(--shadow);padding:16px;display:none}
.pane .title{font-weight:700;margin-bottom:6px}
.pane .close{float:right;border:0;background:transparent;color:var(--ink);cursor:pointer}

/* Shelf physics */
.shelf{perspective:1200px;display:grid;grid-auto-flow:column;gap:14px;overflow:auto;padding-bottom:8px}
.book{width:180px;height:260px;border:1px solid var(--edge);border-radius:14px;background:linear-gradient(180deg,#151a27,#0e1421);transform-style:preserve-3d;transform:rotateY(-18deg) translateZ(40px);transition:transform .25s ease, box-shadow .25s ease}
.book:hover{transform:rotateY(0) translateZ(80px);box-shadow:0 10px 50px rgba(124,240,255,.18)}
.book .spine{writing-mode:vertical-rl;text-orientation:mixed;letter-spacing:.8px;padding:10px;font-family:IBM Plex Mono,ui-monospace,monospace;color:#cbd7ef}

/* Command palette */
.kb-backdrop{position:fixed;inset:0;background:rgba(6,10,18,.45);backdrop-filter:blur(10px);display:none;z-index:80}
.kb{position:fixed;left:50%;top:96px;transform:translateX(-50%);width:min(760px,92vw);border:1px solid var(--edge);border-radius:18px;background:rgba(255,255,255,.06);box-shadow:var(--shadow);display:none;z-index:81}
.kb input{width:100%;background:transparent;color:var(--ink);padding:14px 16px;border:0;outline:none}
.kb ul{max-height:52vh;overflow:auto;margin:0;padding:0;list-style:none}
.kb li{padding:12px 16px;border-top:1px solid var(--edge);cursor:pointer}
.kb li:hover{background:rgba(255,255,255,.06)}

/* Spotlight cursor for links */
a{position:relative}
a::after{content:"";position:absolute;left:0;right:0;bottom:-2px;height:1px;background:linear-gradient(90deg,transparent,rgba(124,240,255,.8),transparent);opacity:0;transition:.2s}
a:hover::after{opacity:1}

/* Accessiblity + motion */
@media (prefers-reduced-motion: reduce){
  *{animation:none!important;transition:none!important}
  .tilt .inner{transform:none!important}
}

/* Performance */
.section{content-visibility:auto;contain-intrinsic-size:1000px 800px}

/* Light theme */
.light{--ink:#0a0e1a;--paper:#f6f7fb;--cyan:#2aa6b9;background:radial-gradient(1200px 600px at 10% -10%, rgba(42,166,185,.14), transparent 60%), #f6f7fb;color:#0a0e1a}
.light .page{background:rgba(255,255,255,.85)}
</style>
</head>
<body>
<div class="paper"></div>
<div class="grid"></div>
<div class="spot" aria-hidden></div>

<nav aria-label="Primary" class="container">
  <a href="#manuscript">Manuscript</a>
  <a href="#dossier">Dossier</a>
  <a href="#projects">Projects</a>
  <a href="#archive">Archive</a>
  <a href="#contact">Contact</a>
  <button id="mode">Mode</button>
  <button id="palette-trigger">Search ⌘K</button>
</nav>

<header class="hero">
  <div class="container wrap">
    <div>
      <span class="badge"><i></i> Stanford · French & Francophone</span>
      <h1 id="headline"></h1>
      <p class="muted">A living manuscript on Negritude, Pan-African thought, postcolonial theory, Afrotopia, and the politics of identity across African and diasporic cultures.</p>
      <div class="cta">
        <a class="btn" href="#dossier">Read the work</a>
        <a class="btn" href="#contact">Invite to speak</a>
      </div>
    </div>
    <div class="card tilt reveal">
      <div class="inner">
        <img src="https://dlcl.stanford.edu/sites/dlcl/files/styles/hs_medium_square_360x360/public/media/image/isreal_winlade-profile_photo_0.jpg.webp?itok=pIxh8DJF" alt="Israel Winlade portrait" style="border-radius:14px"/>
      </div>
      <p class="muted" style="font-size:12px;margin-top:8px">Photo: Stanford DLCL</p>
    </div>
  </div>
</header>

<main>
  <!-- 1) LIVING MANUSCRIPT -->
  <section class="folio section" id="manuscript" data-active="0">
    <div class="page" data-watermark="draft v0">
      <h2>Thesis Line</h2>
      <p class="edit var">The <ins>afterlives</ins> of <del>empire</del> power write themselves in the margins where <span class="caret">language</span> and ceremony meet.</p>
      <p class="marg">[marginal note] Yoruba liturgies as theoretical method.</p>
      <p class="edit">Afrotopia is not a destination but a practice of <ins>world-making</ins>.</p>
      <a class="footref" href="#fn1">[1]</a>
      <dialog class="pane" id="fn1" aria-describedby="fn1c">
        <button class="close" aria-label="Close">×</button>
        <div class="title">On Afrotopia</div>
        <div id="fn1c" class="muted">Felwine Sarr proposes Afrotopia as a horizon of imagination. Here: used as an editorial operation within critical reading.</div>
      </dialog>
    </div>
  </section>

  <section class="folio section" data-active="0">
    <div class="page" data-watermark="peer review">
      <h2>Peer Marginalia</h2>
      <p class="edit">Consider the <ins>diasporic</ins> dimension of sacred language in <del>secular</del> public realms.</p>
      <p class="marg">[peer] Link to ASAA talk on Yorùbá diaspora.</p>
      <p class="edit var">Reframe <ins>Negritude</ins> not as origin but as <ins>relay</ins>.</p>
      <a class="footref" href="#fn2">[2]</a>
      <dialog class="pane" id="fn2" aria-describedby="fn2c">
        <button class="close" aria-label="Close">×</button>
        <div class="title">Relay</div>
        <div id="fn2c" class="muted">A relay repositions canonical movements as ongoing conversations rather than fixed starts.</div>
      </dialog>
    </div>
  </section>

  <section class="folio section" data-active="0">
    <div class="page" data-watermark="edition">
      <h2>Edition</h2>
      <div id="erasureArea" class="edit">
        <p id="erasable"><span>Every</span> <span>archive</span> <span>holds</span> <span>a</span> <span>poem</span> <span>that</span> <span>appears</span> <span>when</span> <span>you</span> <span>erase</span> <span>the</span> <span>noise</span>.</p>
        <canvas id="mask" style="display:block;width:100%;height:160px;border-radius:12px;border:1px dashed var(--edge)"></canvas>
      </div>
      <div id="poem" class="marg" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- 2) DOSSIER (Publications / Awards / Talks) -->
  <section id="dossier" class="section container">
    <h2>Dossier</h2>
    <div class="grid2">
      <div class="card tilt reveal"><div class="inner">
        <strong>“What Shall We Do to Death?”</strong><div class="muted"><em>Wreaths for a Wayfarer</em> (2020)</div>
      </div></div>
      <div class="card tilt reveal"><div class="inner">
        <strong>“A Star Just Fell”</strong><div class="muted"><em>Wreaths for a Wayfarer</em> (2020)</div>
      </div></div>
      <div class="card tilt reveal"><div class="inner">
        <strong>Punocracy Prize for Satire</strong><div class="muted">Winner cohort (2019)</div>
      </div></div>
      <div class="card tilt reveal"><div class="inner">
        <strong>ASAA 2023</strong><div class="muted">Approaching the study of Yorùbá diaspora</div>
      </div></div>
    </div>

    <div class="card constellationWrap" style="margin-top:18px">
      <canvas id="constellation"></canvas>
      <div id="abstract"></div>
    </div>
  </section>

  <!-- 3) PROJECTS (Interactive essays, shelf) -->
  <section id="projects" class="section container">
    <h2>Projects</h2>
    <div class="shelf" id="shelf">
      <div class="book" draggable="true" data-title="Edition: Diaspora"><div class="spine">Edition: Diaspora</div></div>
      <div class="book" draggable="true" data-title="Critical Code Notes"><div class="spine">Critical Code</div></div>
      <div class="book" draggable="true" data-title="Field Notebook"><div class="spine">Field Notebook</div></div>
      <div class="book" draggable="true" data-title="Poster: Afrotopia"><div class="spine">Afrotopia Poster</div></div>
    </div>
  </section>

  <!-- 4) ARCHIVE (timeline) -->
  <section id="archive" class="section container timeline">
    <h2>Archive</h2>
    <div class="scribe" aria-hidden></div>
    <div class="items">
      <div class="artifact" data-date="2019" data-revealed="0">2019 — Satire cohort · Punocracy</div>
      <div class="artifact" data-date="2020" data-revealed="0">2020 — Two poems · <em>Wreaths for a Wayfarer</em></div>
      <div class="artifact" data-date="2023" data-revealed="0">2023 — ASAA talk · Yorùbá diaspora study</div>
      <div class="artifact" data-date="2024" data-revealed="0">2024 — PhD · Stanford French</div>
    </div>
  </section>

  <!-- 5) CONTACT -->
  <section id="contact" class="section container">
    <h2>Contact</h2>
    <p class="muted">Email: iwin [at] stanford.edu</p>
    <form id="contactForm" style="display:grid;gap:12px;max-width:760px">
      <input name="name" placeholder="Your name" class="card" style="padding:12px 14px">
      <input name="email" placeholder="Email" class="card" style="padding:12px 14px">
      <textarea name="message" placeholder="Message" rows="5" class="card" style="padding:12px 14px"></textarea>
      <div style="display:flex;gap:12px">
        <button class="btn" type="submit">Send</button>
        <button class="btn" type="button" id="topBtn">Back to top</button>
      </div>
    </form>
  </section>
</main>

<footer class="muted" style="text-align:center;padding:80px 0">© <span id="y"></span> Israel Winlade — Built as a reading experience.</footer>

<!-- Command Palette -->
<div class="kb-backdrop" id="kbBackdrop"></div>
<div class="kb" id="kb"><input id="kbInput" placeholder="Search sections, papers…"><ul id="kbList"></ul></div>

<script>
// ===== Spotlight cursor
addEventListener('mousemove', e=>{document.documentElement.style.setProperty('--sx', e.clientX+'px');document.documentElement.style.setProperty('--sy', e.clientY+'px');});

// ===== Headline kinetic typing with variable font cues
const headline=document.getElementById('headline');
const lines=['Reading is the interface.','Marginalia is the OS.','Scholarship you can handle.'];
let li=0, ti=0, mode='type';
function typeTick(){
  const s=lines[li];
  if(mode==='type'){ti++; headline.style.fontFamily='Spectral, ui-serif, Georgia'; headline.style.fontVariationSettings='"wght" '+(400+Math.min(500,ti*8)); headline.textContent=s.slice(0,ti); if(ti>=s.length){mode='pause'; setTimeout(()=>mode='erase', 900);} }
  else if(mode==='erase'){ti--; headline.style.fontVariationSettings='"wght" '+(400+Math.max(0,ti*8)); headline.textContent=s.slice(0,ti); if(ti<=0){li=(li+1)%lines.length; mode='type';}}
  requestAnimationFrame(()=>setTimeout(typeTick, mode==='type'?22:12));
}
typeTick();

// ===== Living manuscript activation
const folios=[...document.querySelectorAll('.folio')];
const io=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting){e.target.setAttribute('data-active','1');}}),{threshold:.6});
folios.forEach(s=>{s.setAttribute('data-active','0'); io.observe(s)});

// ===== Marginalia panes
Array.from(document.querySelectorAll('.footref')).forEach(a=>{
  const dlg=document.querySelector(a.getAttribute('href'));
  const close=dlg.querySelector('.close');
  const open=(e)=>{e&&e.preventDefault(); dlg.style.display='block';};
  const x=()=>dlg.style.display='none';
  a.addEventListener('click',open); close.addEventListener('click',x);
});

// ===== Erasure poetry brush
(function(){
  const area=document.getElementById('erasureArea');
  const canvas=document.getElementById('mask');
  const poem=document.getElementById('poem');
  const text=document.getElementById('erasable');
  let ctx,down=false,rect; let dpr=1;
  function size(){dpr=window.devicePixelRatio||1; rect=canvas.getBoundingClientRect(); canvas.width=rect.width*dpr; canvas.height=rect.height*dpr; ctx=canvas.getContext('2d'); ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fillRect(0,0,canvas.width,canvas.height);}
  function draw(x,y){ctx.globalCompositeOperation='destination-out'; ctx.beginPath(); ctx.arc(x*dpr,y*dpr,22*dpr,0,Math.PI*2); ctx.fill();}
  canvas.addEventListener('pointerdown',e=>{down=true;draw(e.offsetX,e.offsetY)});
  canvas.addEventListener('pointermove',e=>down&&draw(e.offsetX,e.offsetY));
  addEventListener('pointerup',()=>{down=false;composePoem()});
  function visible(el){const r=el.getBoundingClientRect(); const cx=r.left+r.width/2 - rect.left; const cy=r.top+r.height/2 - rect.top; const px=Math.max(0,Math.min(canvas.width-1,Math.floor(cx*dpr))); const py=Math.max(0,Math.min(canvas.height-1,Math.floor(cy*dpr))); const data=ctx.getImageData(px,py,1,1).data; return data[3] < 200;}
  function composePoem(){const kept=[...text.querySelectorAll('span')].filter(visible).map(s=>s.textContent); poem.textContent = kept.join(' ');}
  addEventListener('resize',size,{passive:true}); size();
})();

// ===== Constellation (Canvas) with hover abstracts
(function(){
  const c=document.getElementById('constellation'); const a=document.getElementById('abstract');
  const ctx=c.getContext('2d'); let W,H,dpr=1; let nodes=[],edges=[]; 
  const pubs=[
    {id:0,t:'What Shall We Do to Death?',abs:'Poetic meditation from *Wreaths for a Wayfarer* (2020).'},
    {id:1,t:'A Star Just Fell',abs:'Elegiac verse from *Wreaths for a Wayfarer* (2020).'},
    {id:2,t:'Punocracy Satire',abs:'Satire cohort (2019) and practice notes.'},
    {id:3,t:'ASAA 2023 Talk',abs:'Yorùbá diaspora, sacred language, public life.'}
  ];
  function layout(){nodes=[]; edges=[]; const n=pubs.length; const R=Math.min(W,H)*0.28; for(let i=0;i<n;i++){const a=i/n*Math.PI*2; nodes.push({id:pubs[i].id,x:W/2+Math.cos(a)*R,y:H/2+Math.sin(a)*R,r:6+Math.random()*3});}
    // connect by theme
    edges=[[0,1],[1,3],[0,2],[2,3]];}
  function size(){dpr=window.devicePixelRatio||1; W=c.width= c.clientWidth*dpr; H=c.height=c.clientHeight*dpr; ctx.setTransform(1,0,0,1,0,0); layout();}
  function draw(){ctx.clearRect(0,0,W,H); ctx.save(); ctx.scale(dpr,dpr); ctx.globalAlpha=.9; // stars
    ctx.fillStyle='rgba(255,255,255,.6)'; for(const p of nodes){ctx.beginPath(); ctx.arc(p.x/dpr,p.y/dpr,p.r,0,Math.PI*2); ctx.fill();}
    ctx.strokeStyle='rgba(124,240,255,.25)'; for(const [i,j] of edges){const a=nodes[i],b=nodes[j]; ctx.beginPath(); ctx.moveTo(a.x/dpr,a.y/dpr); ctx.lineTo(b.x/dpr,b.y/dpr); ctx.stroke();}
    ctx.restore(); requestAnimationFrame(draw);} 
  function hit(mx,my){let k=-1,d=1e9; for(let i=0;i<nodes.length;i++){const p=nodes[i]; const dx=mx*dpr-p.x, dy=my*dpr-p.y, dd=Math.hypot(dx,dy); if(dd<d && dd < 28){d=dd;k=i;}} return k;}
  c.addEventListener('mousemove',e=>{const r=c.getBoundingClientRect(); const i=hit(e.clientX-r.left,e.clientY-r.top); if(i>-1){const pub=pubs[nodes[i].id]; a.style.display='block'; a.innerHTML='<strong>'+pub.t+'</strong><div class="muted">'+pub.abs+'</div>'; } else {a.style.display='none';}});
  addEventListener('resize',size); size(); draw();
})();

// ===== Shelf physics (drag to pull out)
(function(){const books=[...document.querySelectorAll('.book')]; let startX, startY;
  books.forEach(b=>{b.addEventListener('dragstart',e=>{startX=e.clientX; startY=e.clientY; b.style.opacity=.8}); b.addEventListener('dragend',e=>{const dx=e.clientX-startX, dy=e.clientY-startY; const dist=Math.hypot(dx,dy); if(dist>20){b.style.transform='rotateY(0) translateZ(120px)'; setTimeout(()=>b.style.transform='',800);} b.style.opacity='';});});})();

// ===== Scroll As Time (reveal artifacts)
(function(){const arts=[...document.querySelectorAll('.artifact')]; const reveal=()=>{const mid=innerHeight*0.45; arts.forEach(a=>{const r=a.getBoundingClientRect(); if(r.top<mid && a.dataset.revealed==='0'){a.dataset.revealed='1';}})}; addEventListener('scroll',reveal,{passive:true}); reveal();})();

// ===== Command palette
const KB=[{label:'Manuscript',href:'#manuscript'},{label:'Dossier',href:'#dossier'},{label:'Projects',href:'#projects'},{label:'Archive',href:'#archive'},{label:'Contact',href:'#contact'}];
const kb=document.getElementById('kb'), back=document.getElementById('kbBackdrop'), list=document.getElementById('kbList');
const input=document.getElementById('kbInput');
function openKB(){kb.style.display='block';back.style.display='block';input.value='';render('');input.focus();}
function closeKB(){kb.style.display='none';back.style.display='none';}
function render(q){const f=KB.filter(i=>i.label.toLowerCase().includes(q.toLowerCase()));list.innerHTML=f.map(i=>`<li data-href="${i.href}">${i.label}</li>`).join('');}
addEventListener('keydown',e=>{if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==='k'){e.preventDefault();openKB();} if(e.key==='Escape')closeKB();});
back.addEventListener('click',closeKB); list.addEventListener('click',e=>{const li=e.target.closest('li'); if(!li)return; document.querySelector(li.dataset.href)?.scrollIntoView({behavior:'smooth'}); closeKB();}); input.addEventListener('input',e=>render(e.target.value));

// ===== Annotation Heatmap (local only)
(function(){
  const KEY='heatmap:v1'; const store=JSON.parse(localStorage.getItem(KEY)||'{}');
  const sentences=[...document.querySelectorAll('#manuscript .page p')];
  sentences.forEach((p,i)=>{const id='s'+i; p.dataset.sid=id; const count=store[id]||0; shade(p,count);});
  function shade(el,count){el.style.background=`linear-gradient(90deg, rgba(124,240,255,${Math.min(.18,count/8)}), transparent)`}
  function save(id){store[id]=(store[id]||0)+1; localStorage.setItem(KEY,JSON.stringify(store));}
  addEventListener('mouseup',()=>{const sel=getSelection(); if(sel && sel.toString().trim()){const n=sel.anchorNode && sel.anchorNode.parentElement && sel.anchorNode.parentElement.closest('[data-sid]'); if(n){save(n.dataset.sid); shade(n,store[n.dataset.sid]);}}});
})();

// ===== Mode toggle
const mode=document.getElementById('mode'); mode.addEventListener('click',()=>document.body.classList.toggle('light'));

// ===== Smooth UX
addEventListener('mousemove', e=>{document.documentElement.style.setProperty('--sx', e.clientX+'px');document.documentElement.style.setProperty('--sy', e.clientY+'px');});

document.getElementById('y').textContent=new Date().getFullYear();

document.getElementById('topBtn').addEventListener('click',()=>scrollTo({top:0,behavior:'smooth'}));
</script>
</body>
</html>
